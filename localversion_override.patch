--- a/build/kernel/kleaf/impl/kernel_build.bzl
+++ b/build/kernel/kleaf/impl/kernel_build.bzl
@@ -274,6 +274,10 @@
         "outs": attr.output_list(
             doc = "The list of output files from the kernel build.",
         ),
+        "localversion_override": attr.string(
+            doc = "A custom string to completely replace the generated localversion.",
+            default = "",
+        ),
         "_for_test": attr.bool(default = False),
     },
     toolchains = [str(Label("//build/kernel/kleaf:hermetic_toolchain_type"))],
@@ -395,6 +399,7 @@
     )
     kernel_config(
         name = ctx.attr.name + ".config",
+        localversion_override = ctx.attr.localversion_override,
         outs = config_outs,
         base_config = base_config,
         build_config = build_config_path,
--- a/build/kernel/kleaf/impl/stamp.bzl
+++ b/build/kernel/kleaf/impl/stamp.bzl
@@ -40,6 +40,14 @@
         output localversion file
     """
 
+    # If an override is provided, use it and skip everything else.
+    if hasattr(ctx.attr, "localversion_override") and ctx.attr.localversion_override:
+        ctx.actions.write(
+            output = out_file,
+            content = ctx.attr.localversion_override,
+        )
+        return out_file
+
     out_file = ctx.actions.declare_file(ctx.attr.name + "/localversion")
     if ctx.attr._config_is_stamp[BuildSettingInfo].value:
         inputs = [ctx.info_file]
